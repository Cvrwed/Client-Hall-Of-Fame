package frapppyz.cutefurry.pics.modules.impl.exploit;

import frapppyz.cutefurry.pics.Wrapper;
import frapppyz.cutefurry.pics.event.Event;
import frapppyz.cutefurry.pics.event.impl.*;
import frapppyz.cutefurry.pics.modules.Category;
import frapppyz.cutefurry.pics.modules.Mod;
import frapppyz.cutefurry.pics.modules.settings.impl.Mode;
import frapppyz.cutefurry.pics.notifications.Type;
import frapppyz.cutefurry.pics.util.PacketUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.*;
import net.minecraft.network.play.server.S02PacketChat;
import net.minecraft.network.play.server.S08PacketPlayerPosLook;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;
import java.util.ArrayList;

public class Disabler extends Mod {

    private Mode mode = new Mode("Mode", "BlocksMC","BlocksMC", "Cubecraft", "Hypixel", "Vulcan", "Hazel", "Minemen", "Watchduck", "PvPLegacy", "Sparky");

    private ArrayList<Packet> packets = new ArrayList<>();
    private ArrayList<Packet> packets2 = new ArrayList<>();

    public Disabler() {
        super("Disabler", "Disables many anticheats", 0, Category.EXPLOIT);
        addSettings(mode);
    }

    public void onEvent(Event e){
        if(e instanceof Render){
            this.setSuffix(mode.getMode());
        }
        if(e instanceof Update){
            switch(mode.getMode()){

                case "Watchduck":

                    if(mc.thePlayer.ticksExisted % 3 == 0 && mc.thePlayer.ticksExisted > 60 && !(Wrapper.getModManager().getModByName("Fly").isToggled() || Wrapper.getModManager().getModByName("Speed").isToggled())) PacketUtil.sendPacketNoEvent(new C03PacketPlayer.C04PacketPlayerPosition(mc.thePlayer.posX, mc.thePlayer.posY + Math.random(), mc.thePlayer.posZ, true));
                    break;

                case "Cubecraft":
                    if(mc.thePlayer.ticksExisted % 5 == 0 || mc.thePlayer.ticksExisted <= 10){
                        PacketUtil.sendPacketNoEvent(new C0CPacketInput());
                        PacketUtil.sendPacketNoEvent(new C19PacketResourcePackStatus("", C19PacketResourcePackStatus.Action.SUCCESSFULLY_LOADED));
                    }
                    break;
            }

        }
        if(e instanceof Motion){
            switch (mode.getMode()){
                case "Sparky":
                    PacketUtil.sendPacketNoEvent(new C0CPacketInput(555.98f, 555.98f, false, true));
                    mc.thePlayer.capabilities.allowFlying = true;
                    PacketUtil.sendPacketNoEvent(new C13PacketPlayerAbilities(mc.thePlayer.capabilities));
                    break;
                case "Cubecraft":
                    ((Motion) e).setOnGround(true);
                    break;

                case "Vulcan":
                    if(mc.thePlayer.ticksExisted <= 10){
                        packets.clear();
                    }
                    PacketUtil.sendPacketNoEvent(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.START_DESTROY_BLOCK, BlockPos.ORIGIN.add(Math.random(), 1, -Math.random()/2), EnumFacing.UP));
                    break;

                case "PvPLegacy":
                    if(mc.thePlayer.ticksExisted % 40 == 0) {
                        PacketUtil.sendPacketNoEvent(new C0CPacketInput((float) 0, (float) 0, false, true));
                        ((Motion) e).setY(((Motion) e).getY() - 18);
                        Wrapper.getNotifications().postNotification("Disabler", "Packet sent", String.valueOf(((Motion) e).getY()), Type.INFO, 500);
                        PacketUtil.sendPacketNoEvent(new C0CPacketInput((float) 0, (float) 0, false, true));
                    }
                    break;


                case "Hazel":
                    ((Motion) e).setOnGround(true);
                    if(mc.thePlayer.ticksExisted % 10 == 1){
                        ((Motion) e).setY(-16);
                    }
                    break;

                case "Minemen":
                    PacketUtil.sendPacketNoEvent(new C0CPacketInput((float) 0.98, (float) 0.98, true, false));
                    PacketUtil.sendPacketNoEvent(new C0CPacketInput((float) 0.98, (float) 0.98, false, true));
                    break;
            }
        }

        if(e instanceof ReceivePacket && mc.thePlayer != null){


            if(mode.is("Hazel") && ((ReceivePacket) e).getPacket() instanceof S02PacketChat){
                if(((S02PacketChat) ((ReceivePacket) e).getPacket()).getChatComponent().getUnformattedText().contains("Now entering:") || ((S02PacketChat) ((ReceivePacket) e).getPacket()).getChatComponent().getUnformattedText().contains("Now leaving:")){
                    e.setCancelled(true);
                }
            }

            if(mode.is("Watchduck") && mc.thePlayer.ticksExisted % 3 != 0 && ((ReceivePacket) e).getPacket() instanceof S08PacketPlayerPosLook){
                e.setCancelled(true);
            }

            if(((ReceivePacket) e).getPacket() instanceof S08PacketPlayerPosLook && (mode.is("PvPLegacy") && mc.thePlayer.ticksExisted % 40 <= 10 || mode.is("Hazel")) && mc.thePlayer.ticksExisted> 40 && mc.thePlayer.ticksExisted % 10 <= 5){
                e.setCancelled(true);

                PacketUtil.sendPacketNoEvent(new C03PacketPlayer.C06PacketPlayerPosLook(((S08PacketPlayerPosLook) ((ReceivePacket) e).getPacket()).getX(), ((S08PacketPlayerPosLook) ((ReceivePacket) e).getPacket()).getY(), ((S08PacketPlayerPosLook) ((ReceivePacket) e).getPacket()).getZ(), ((S08PacketPlayerPosLook) ((ReceivePacket) e).getPacket()).getYaw(), ((S08PacketPlayerPosLook) ((ReceivePacket) e).getPacket()).getPitch(), true));
            }
        }
        if(e instanceof SendPacket){


                switch(mode.getMode()){

                    case "Cubecraft":
                        e.setCancelled(!(((SendPacket) e).getPacket() instanceof C02PacketUseEntity || ((SendPacket) e).getPacket() instanceof C00PacketKeepAlive ||
                                ((SendPacket) e).getPacket() instanceof C03PacketPlayer || ((SendPacket) e).getPacket() instanceof  C08PacketPlayerBlockPlacement ||
                                ((SendPacket) e).getPacket() instanceof C0FPacketConfirmTransaction || ((SendPacket) e).getPacket() instanceof C10PacketCreativeInventoryAction ||
                                ((SendPacket) e).getPacket() instanceof C09PacketHeldItemChange || ((SendPacket) e).getPacket() instanceof C0DPacketCloseWindow ||
                                ((SendPacket) e).getPacket() instanceof C0EPacketClickWindow || ((SendPacket) e).getPacket() instanceof C07PacketPlayerDigging ||
                                ((SendPacket) e).getPacket() instanceof C01PacketChatMessage));
                        if(((SendPacket) e).getPacket() instanceof C02PacketUseEntity){
                              PacketUtil.sendPacketNoEvent(new C0APacketAnimation());
                        }
                        break;

                    case "Minemen":

                        if(!Wrapper.getModManager().getModByName("Blink").isToggled()){
                            if(mc.thePlayer.ticksExisted % (mc.timer.timerSpeed != 0 ? 2 : 9) != 0){
                                e.setCancelled(true);
                                packets.add(((SendPacket) e).getPacket());
                            }else{
                                packets.forEach(PacketUtil::sendPacketNoEvent);
                                packets.clear();
                            }

                            if(mc.timer.timerSpeed != 1){
                                if(((SendPacket) e).getPacket() instanceof C0FPacketConfirmTransaction){
                                    e.setCancelled(true);
                                    PacketUtil.sendDelayedPacketNoEvent(((SendPacket) e).getPacket(), 1500);
                                }
                            }
                        }

                        break;

                    case "Vulcan":
                        if(mc.thePlayer != null){
                            if(mc.thePlayer.ticksExisted % 4 != 0 && Wrapper.getModManager().getModByName("Fly").isToggled() && ((SendPacket) e).getPacket() instanceof C03PacketPlayer && mc.timer.timerSpeed == 1){
                                e.setCancelled(true);
                            }


                        }

                        break;

                    case "Hypixel":

                        if (mc.thePlayer.ticksExisted >= 20 && mc.thePlayer.ticksExisted < 105) {
                            e.setCancelled(true);
                            Wrapper.getLogger().addChat("Disabling strafe checks. Please hold space. (" + mc.thePlayer.ticksExisted + ")");
                            if(mc.thePlayer.onGround){
                                mc.thePlayer.jump();
                            }
                        }

                        break;
                    case "Hazel":

                        break;
                    case "BlocksMC":
                        if(!Wrapper.getModManager().getModByName("Fly").isToggled()){
                            if(mc.thePlayer.ticksExisted < 40 && (((SendPacket) e).getPacket()) instanceof C0FPacketConfirmTransaction) {
                                C0FPacketConfirmTransaction p = (C0FPacketConfirmTransaction)((SendPacket) e).getPacket();
                                e.setCancelled(true);
                                PacketUtil.sendPacketNoEvent(new C0FPacketConfirmTransaction(p.getWindowId(), Short.MIN_VALUE, true));
                            }else{
                                if(!packets.isEmpty()){
                                    packets.forEach(PacketUtil::sendPacketNoEvent);
                                    packets.clear();
                                }
                            }
                        }else if(((SendPacket) e).getPacket() instanceof C03PacketPlayer){
                            e.setCancelled(true);
                            packets.add(((SendPacket) e).getPacket());
                        }
                        break;
                }



        }
    }
}