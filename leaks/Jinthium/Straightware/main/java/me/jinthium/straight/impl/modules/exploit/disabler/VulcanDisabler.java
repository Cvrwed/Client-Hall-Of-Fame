package me.jinthium.straight.impl.modules.exploit.disabler;


import best.azura.irc.utils.Wrapper;
import io.mxngo.echo.Callback;
import io.mxngo.echo.EventCallback;
import me.jinthium.straight.impl.components.BadPacketsComponent;
import me.jinthium.straight.impl.components.BlinkComponent;
import me.jinthium.straight.impl.event.movement.PlayerUpdateEvent;
import me.jinthium.straight.impl.event.network.PacketEvent;
import me.jinthium.straight.impl.modules.exploit.Disabler;
import me.jinthium.straight.impl.settings.BooleanSetting;
import me.jinthium.straight.impl.settings.MultiBoolSetting;
import me.jinthium.straight.impl.settings.mode.ModeInfo;
import me.jinthium.straight.impl.settings.mode.ModuleMode;
import me.jinthium.straight.impl.utils.network.PacketUtil;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.client.C17PacketCustomPayload;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;

@ModeInfo(name = "Vulcan", parent = Disabler.class)
public class VulcanDisabler extends ModuleMode<Disabler> {

    private final MultiBoolSetting vulcanComponents = new MultiBoolSetting("Vulcan Components",
            new BooleanSetting("Reach", true),
            new BooleanSetting("Strafe (Test)", false),
            new BooleanSetting("Auto Clicker", true),
            new BooleanSetting("Bad Packets", true),
            new BooleanSetting("Fast Use (Test)", false));

    public VulcanDisabler() {
        this.registerSettings(vulcanComponents);
    }

    @Callback
    final EventCallback<PacketEvent> packetEventCallback = event -> {
        if(event.getPacketState() == PacketEvent.PacketState.SENDING){
            if(event.getPacket() instanceof C17PacketCustomPayload && vulcanComponents.isEnabled("Bad Packets"))
                event.cancel();

            if(event.getPacket() instanceof C0BPacketEntityAction)
                event.cancel();
        }
    };

    @Callback
    final EventCallback<PlayerUpdateEvent> playerUpdateEventCallback = event -> {
        if(event.isPre()){
//            Wrapper.sendMessage("eee");
            vulcanComponents.getBoolSettings().forEach(component -> {
                if (component.isEnabled()) {
                    switch (component.getName()) {
                        case "Reach" -> {
                            BlinkComponent.blinking = true;
                            if(mc.thePlayer.ticksExisted % 2 == 0)
                                BlinkComponent.dispatch();
                        }
                        case "Strafe" -> {
                            if(mc.thePlayer.ticksExisted % 5 == 0)
                                PacketUtil.sendPacket(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.STOP_DESTROY_BLOCK,
                                        new BlockPos(mc.thePlayer), EnumFacing.UP));
                        }
                        case "Auto Clicker" -> {
                            if(!BadPacketsComponent.bad(false, true, true, false, false) && mc.currentScreen == null)
                                PacketUtil.sendPacket(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.START_DESTROY_BLOCK,
                                        new BlockPos(mc.thePlayer), EnumFacing.UP));
                        }
                        case "Fast Use" -> {
                            if(mc.thePlayer.ticksExisted % 7 == 0)
                                PacketUtil.sendPacket(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.DROP_ITEM,
                                        BlockPos.ORIGIN, EnumFacing.DOWN));
                        }
                    }
                }
            });
        }
    };

}
